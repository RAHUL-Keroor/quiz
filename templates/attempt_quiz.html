{% extends "base.html" %}
{% block title %}Attempt Quiz{% endblock %}
{% block content %}

<div class="container mt-4">
  <h2 class="text-center mb-4">
    üß† Attempt Quiz ‚Äî {{ quiz.quiz_code }}
  </h2>

  {% if not final_view %}
  <!-- QUIZ FORM -->
  <form method="POST">
    {% for q in questions %}
    <div class="card mb-3 shadow-sm">
      <div class="card-body">
        <h5>Q{{ loop.index }}. {{ q.question_text }}</h5>

        {% if q.options %}
          {% for opt in q.options %}
          <div class="form-check">
            <input
              class="form-check-input"
              type="radio"
              name="q_{{ q._id }}"
              id="q_{{ q._id }}_{{ loop.index }}"
              value="{{ opt }}"
              required
            >
            <label class="form-check-label" for="q_{{ q._id }}_{{ loop.index }}">
              {{ opt }}
            </label>
          </div>
          {% endfor %}
        {% else %}
          <p class="text-muted">‚ö†Ô∏è No options found for this question.</p>
        {% endif %}
      </div>
    </div>
    {% endfor %}

    <div class="text-center mt-4">
      <button type="submit" class="btn btn-primary px-5">Submit Quiz</button>
    </div>
  </form>

  {% else %}
  <!-- QUIZ RESULT -->
  <div class="alert alert-info text-center shadow-sm">
    <h4>‚úÖ Your Score: {{ score }} / {{ total_questions }}</h4>
  </div>

  {% for q in questions %}
  {% set qid = q._id|string %}
  {% set user_ans = submitted.get(qid) %}
  <div class="card mb-3">
    <div class="card-body">
      <h5>Q{{ loop.index }}. {{ q.question_text }}</h5>
      <p><strong>Your Answer:</strong> {{ user_ans or "Not answered" }}</p>
      <p><strong>Correct Answer:</strong> {{ q.correct_answer }}</p>
      {% if q.description %}
      <p class="text-muted"><strong>Explanation:</strong> {{ q.description }}</p>
      {% endif %}
      {% if user_ans == q.correct_answer %}
      <span class="badge bg-success">Correct</span>
      {% else %}
      <span class="badge bg-danger">Incorrect</span>
      {% endif %}
    </div>
  </div>
  {% endfor %}
  {% endif %}
</div>

{% endblock %}
